<!doctype html>
<html lang="ru">
  <head>
    <!-- продолжаем -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>Arconique · Каталог / Админ / Калькулятор</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="data:," />
  </head>
  <body class="bg-white">
    <div id="root"></div>

    <!-- React 18 UMD + Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      const { useEffect, useMemo, useRef, useState } = React;
      const { createRoot } = ReactDOM;

      // Константы
      const PIN_CODE = "334346";
      const LS_CATALOG = "arq_catalog_v1";

      // Утилиты
      const uid = () => Math.random().toString(36).slice(2, 9);
      const clamp = (v, lo, hi) => Math.min(hi, Math.max(lo, v));
      const fmtInt = (n) => new Intl.NumberFormat("ru-RU", { maximumFractionDigits: 0 }).format(Math.round(n || 0));
      const fmtMoney = (n, c = "USD") =>
        new Intl.NumberFormat("en-US", { style: "currency", currency: c, maximumFractionDigits: 0 }).format(Math.round(n || 0));

      // Хранилище
      const loadCatalog = () => {
        try {
          const raw = localStorage.getItem(LS_CATALOG);
          if (!raw) return defaultCatalog();
          const parsed = JSON.parse(raw);
          return Array.isArray(parsed) ? parsed : defaultCatalog();
        } catch {
          return defaultCatalog();
        }
      };
      const saveCatalog = (catalog) => {
        try {
          localStorage.setItem(LS_CATALOG, JSON.stringify(catalog));
        } catch {}
      };

      // Демо-данные по умолчанию
      function defaultCatalog() {
        return [
          {
            projectId: "ahau-gardens",
            projectName: "Ahau Gardens by Arconique",
            villas: [
              {
                villaId: "ahau-type-a-2br",
                name: "Type A 2 bedroom",
                area: 142.7,
                ppsm: 2200,
                baseUSD: 313940,
                monthlyPriceGrowthPct: 1.5,
                leaseholdEndDate: "2055-01-01",
                dailyRateUSD: 220,
                rentalPriceIndexPct: 5,
              },
              {
                villaId: "ahau-type-b-2br",
                name: "Type B 2 bedroom",
                area: 192,
                ppsm: 2250,
                baseUSD: 432000,
                monthlyPriceGrowthPct: 1.5,
                leaseholdEndDate: "2055-01-01",
                dailyRateUSD: 280,
                rentalPriceIndexPct: 5,
              },
            ],
          },
          {
            projectId: "enso-villas",
            projectName: "ENSO by Arconique",
            villas: [
              {
                villaId: "enso-l-type-2br",
                name: "L type 2 bedroom",
                area: 104.1,
                ppsm: 2610,
                baseUSD: 271701,
                monthlyPriceGrowthPct: 1.5,
                leaseholdEndDate: "2054-12-01",
                dailyRateUSD: 220,
                rentalPriceIndexPct: 5,
              },
              {
                villaId: "enso-v-type-2br",
                name: "V type 2 bedroom",
                area: 114.1,
                ppsm: 2548,
                baseUSD: 290840,
                monthlyPriceGrowthPct: 1.5,
                leaseholdEndDate: "2054-12-01",
                dailyRateUSD: 220,
                rentalPriceIndexPct: 5,
              },
            ],
          },
          {
            projectId: "eternal-villas",
            projectName: "Eternal Villas by Arconique",
            villas: [
              {
                villaId: "eternal-premium-3br",
                name: "Premium 3 bedroom",
                area: 218,
                ppsm: 2197,
                baseUSD: 479000,
                monthlyPriceGrowthPct: 1.5,
                leaseholdEndDate: "2055-01-01",
                dailyRateUSD: 550,
                rentalPriceIndexPct: 5,
              },
            ],
          },
        ];
      }

      // Роутер на hash
      function useHashRoute() {
        const parse = () => {
          const hash = window.location.hash || "#/catalog";
          const [path, q] = hash.split("?");
          const params = {};
          if (q) {
            q.split("&").forEach((p) => {
              const [k, v] = p.split("=");
              params[decodeURIComponent(k)] = decodeURIComponent(v || "");
            });
          }
          return { path, params };
        };
        const [route, setRoute] = useState(parse());
        useEffect(() => {
          const onHash = () => setRoute(parse());
          window.addEventListener("hashchange", onHash);
          return () => window.removeEventListener("hashchange", onHash);
        }, []);
        return route;
      }

      // Шапка
      function Header() {
        return (
          <header className="sticky top-0 z-40 bg-white/80 backdrop-blur border-b border-neutral-200">
            <div className="mx-auto max-w-7xl px-5 py-3 flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="h-9 w-9 rounded-2xl bg-neutral-900 text-white grid place-items-center font-semibold">A</div>
                <div className="leading-tight">
                  <div className="font-semibold">Arconique</div>
                  <div className="text-xs text-neutral-500">Каталог · Админ · Калькулятор</div>
                </div>
              </div>
              <nav className="flex items-center gap-3 text-sm">
                <a href="#/catalog" className="px-3 py-1.5 rounded-lg border hover:bg-neutral-50">Каталог</a>
                <a href="#/admin" className="px-3 py-1.5 rounded-lg border hover:bg-neutral-50">Админ</a>
              </nav>
            </div>
          </header>
        );
      }

      // Админ: вход
      function AdminGate({ onLogin }) {
        const [pin, setPin] = useState("");
        const [error, setError] = useState("");
        return (
          <div className="mx-auto max-w-md p-5">
            <h2 className="text-xl font-semibold mb-3">Вход в админ‑панель</h2>
            <div className="grid gap-3 border rounded-2xl p-4">
              <label className="grid gap-1">
                <span className="text-sm text-neutral-600">PIN</span>
                <input
                  type="password"
                  className="px-3 py-2 rounded-xl border"
                  value={pin}
                  onChange={(e) => setPin(e.target.value)}
                  placeholder="Введите PIN"
                />
              </label>
              {error && <div className="text-red-600 text-sm">{error}</div>}
              <div className="flex gap-2">
                <button
                  className="px-4 py-2 rounded-xl bg-neutral-900 text-white"
                  onClick={() => {
                    if (pin === PIN_CODE) onLogin();
                    else setError("Неверный PIN");
                  }}
                >
                  Войти
                </button>
                <a href="#/catalog" className="px-4 py-2 rounded-xl border">Назад</a>
              </div>
            </div>
          </div>
        );
      }

      // Админ: панель
      function AdminPanel({ catalog, setCatalog }) {
        const [showAddProject, setShowAddProject] = useState(false);
        const [newProjectName, setNewProjectName] = useState("");
        const fileRef = useRef(null);

        const addProject = () => {
          const name = (newProjectName || "").trim();
          if (!name) return;
          const projectId = name.toLowerCase().replace(/\s+/g, "-").replace(/[^a-z0-9-]/g, "");
          if (catalog.some((p) => p.projectId === projectId)) {
            alert("Проект с таким ID уже есть");
            return;
          }
          const next = [...catalog, { projectId, projectName: name, villas: [] }];
          setCatalog(next);
          saveCatalog(next);
          setNewProjectName("");
          setShowAddProject(false);
        };

        const addVilla = (projectId) => {
          const name = prompt("Название виллы:");
          if (!name) return;
          const area = parseFloat(prompt("Площадь (м²):", "100") || "0");
          const ppsm = parseFloat(prompt("Цена за м² ($):", "2500") || "0");
          const baseUSD = parseFloat(prompt("Базовая цена ($):", String(Math.round(area * ppsm))) || "0");
          const monthlyPriceGrowthPct = parseFloat(prompt("Месячный рост цены до ключей (%):", "1.5") || "0");
          const leaseholdEndDate = prompt("Дата окончания лизхолда (YYYY-MM-DD):", "2055-01-01") || "2055-01-01";
          const dailyRateUSD = parseFloat(prompt("Стоимость ночи ($):", "150") || "0");
          const rentalPriceIndexPct = parseFloat(prompt("Рост аренды/год (%):", "5") || "0");

          const villaId =
            projectId +
            "-" +
            name.toLowerCase().replace(/\s+/g, "-").replace(/[^a-z0-9-]/g, "");
          const next = catalog.map((p) =>
            p.projectId === projectId
              ? {
                  ...p,
                  villas: [
                    ...p.villas,
                    {
                      villaId,
                      name,
                      area,
                      ppsm,
                      baseUSD,
                      monthlyPriceGrowthPct,
                      leaseholdEndDate,
                      dailyRateUSD,
                      rentalPriceIndexPct,
                    },
                  ],
                }
              : p
          );
          setCatalog(next);
          saveCatalog(next);
        };

        const deleteVilla = (projectId, villaId) => {
          if (!confirm("Удалить виллу?")) return;
          const next = catalog.map((p) =>
            p.projectId === projectId
              ? { ...p, villas: p.villas.filter((v) => v.villaId !== villaId) }
              : p
          );
          setCatalog(next);
          saveCatalog(next);
        };

        const deleteProject = (projectId) => {
          if (!confirm("Удалить проект и все его виллы?")) return;
          const next = catalog.filter((p) => p.projectId !== projectId);
          setCatalog(next);
          saveCatalog(next);
        };

        const exportJSON = () => {
          const blob = new Blob([JSON.stringify(catalog, null, 2)], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `arconique_catalog_${new Date().toISOString().slice(0, 10)}.json`;
          a.click();
          URL.revokeObjectURL(url);
        };

        const importJSON = (file) => {
          if (!file) return;
          file.text().then((txt) => {
            try {
              const data = JSON.parse(txt);
              if (!Array.isArray(data)) throw new Error("Неверный формат");
              setCatalog(data);
              saveCatalog(data);
            } catch (e) {
              alert("Ошибка импорта: " + e.message);
            }
          });
        };

        return (
          <div className="mx-auto max-w-7xl px-5 py-6">
            <div className="flex flex-wrap items-center justify-between gap-3 mb-4">
              <h2 className="text-xl font-semibold">Админ‑панель</h2>
              <div className="flex items-center gap-2">
                <button className="px-3 py-1.5 rounded-lg border" onClick={() => setShowAddProject(true)}>Добавить проект</button>
                <button className="px-3 py-1.5 rounded-lg border" onClick={exportJSON}>Экспорт JSON</button>
                <label className="px-3 py-1.5 rounded-lg border cursor-pointer">
                  Импорт JSON
                  <input ref={fileRef} type="file" accept="application/json,.json" className="hidden" onChange={(e) => importJSON(e.target.files?.[0])} />
                </label>
                <a href="#/catalog" className="px-3 py-1.5 rounded-lg border">Выйти</a>
              </div>
            </div>

            {showAddProject && (
              <div className="mb-4 grid gap-2 border rounded-2xl p-4">
                <label className="grid gap-1">
                  <span className="text-sm text-neutral-600">Название проекта</span>
                  <input className="px-3 py-2 rounded-xl border" value={newProjectName} onChange={(e) => setNewProjectName(e.target.value)} />
                </label>
                <div className="flex gap-2">
                  <button className="px-3 py-1.5 rounded-lg bg-neutral-900 text-white" onClick={addProject}>Сохранить</button>
                  <button className="px-3 py-1.5 rounded-lg border" onClick={() => setShowAddProject(false)}>Отмена</button>
                </div>
              </div>
            )}

            <div className="grid gap-6">
              {catalog.map((project) => (
                <div key={project.projectId} className="border rounded-2xl p-4 bg-white">
                  <div className="flex items-center justify-between">
                    <h3 className="text-lg font-semibold">{project.projectName}</h3>
                    <div className="flex gap-2">
                      <button className="px-3 py-1.5 rounded-lg border" onClick={() => addVilla(project.projectId)}>Добавить виллу</button>
                      <button className="px-3 py-1.5 rounded-lg border text-red-600" onClick={() => deleteProject(project.projectId)}>Удалить проект</button>
                    </div>
                  </div>

                  <div className="mt-3 overflow-x-auto">
                    <table className="w-full text-sm min-w-[900px]">
                      <thead>
                        <tr className="bg-neutral-50">
                          <Th>Вилла</Th>
                          <Th>Площадь, м²</Th>
                          <Th>$ / м²</Th>
                          <Th>База, $</Th>
                          <Th>Рост/мес, %</Th>
                          <Th>Лизхолд до</Th>
                          <Th>Ночь, $</Th>
                          <Th>Индекс аренды, %/год</Th>
                          <Th>Действия</Th>
                        </tr>
                      </thead>
                      <tbody>
                        {project.villas.map((v) => (
                          <tr key={v.villaId} className="border-t">
                            <Td>{v.name}</Td>
                            <Td>{fmtInt(v.area)}</Td>
                            <Td>{fmtInt(v.ppsm)}</Td>
                            <Td>{fmtInt(v.baseUSD)}</Td>
                            <Td>{(v.monthlyPriceGrowthPct ?? 0).toFixed(1)}</Td>
                            <Td>{v.leaseholdEndDate}</Td>
                            <Td>{fmtInt(v.dailyRateUSD)}</Td>
                            <Td>{(v.rentalPriceIndexPct ?? 0).toFixed(1)}</Td>
                            <Td>
                              <div className="flex gap-2">
                                <a className="px-2 py-1 rounded-lg text-xs bg-neutral-900 text-white" href={`#/calc?villaId=${encodeURIComponent(v.villaId)}`}>Рассчитать</a>
                                <button className="px-2 py-1 rounded-lg text-xs border" onClick={() => deleteVilla(project.projectId, v.villaId)}>Удалить</button>
                              </div>
                            </Td>
                          </tr>
                        ))}
                        {project.villas.length === 0 && (
                          <tr><td className="px-3 py-3 text-neutral-500 text-sm" colSpan={9}>Виллы отсутствуют</td></tr>
                        )}
                      </tbody>
                    </table>
                  </div>
                </div>
              ))}
            </div>
          </div>
        );
      }

      // Публичный каталог
      function CatalogView({ catalog }) {
        return (
          <div className="mx-auto max-w-7xl px-5 py-6">
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-xl font-semibold">Каталог проектов</h2>
              <a href="#/admin" className="px-3 py-1.5 rounded-lg border">Админ</a>
            </div>

            <div className="grid gap-8">
              {catalog.map((project) => (
                <section key={project.projectId} className="bg-[#f8f5ef] text-neutral-900 rounded-3xl border p-4">
                  <div className="flex items-end justify-between">
                    <h3 className="text-xl font-semibold">{project.projectName}</h3>
                  </div>

                  <div className="mt-3 overflow-x-auto">
                    <table className="w-full text-[clamp(11px,0.9vw,14px)] min-w-[1000px]">
                      <thead>
                        <tr className="bg-neutral-50">
                          <Th>Вилла</Th>
                          <Th>Площадь, м²</Th>
                          <Th>$ / м²</Th>
                          <Th>База, $</Th>
                          <Th>Лизхолд до</Th>
                          <Th>Ночь, $</Th>
                          <Th>Индекс аренды, %/год</Th>
                          <Th><span className="inline-block w-[140px]">Действия</span></Th>
                        </tr>
                      </thead>
                      <tbody>
                        {project.villas.map((v) => (
                          <tr key={v.villaId} className="border-t">
                            <Td className="whitespace-nowrap">{v.name}</Td>
                            <Td>{fmtInt(v.area)}</Td>
                            <Td>{fmtInt(v.ppsm)}</Td>
                            <Td>{fmtInt(v.baseUSD)}</Td>
                            <Td>{v.leaseholdEndDate}</Td>
                            <Td>{fmtInt(v.dailyRateUSD)}</Td>
                            <Td>{(v.rentalPriceIndexPct ?? 0).toFixed(1)}</Td>
                            <Td>
                              <div className="w-[140px]">
                                <a className="px-3 py-1.5 rounded-lg text-xs bg-neutral-900 text-white" href={`#/calc?villaId=${encodeURIComponent(v.villaId)}`}>Рассчитать</a>
                              </div>
                            </Td>
                          </tr>
                        ))}
                        {project.villas.length === 0 && (
                          <tr><td className="px-3 py-3 text-neutral-500" colSpan={8}>Нет вилл</td></tr>
                        )}
                      </tbody>
                    </table>
                  </div>
                </section>
              ))}
            </div>
          </div>
        );
      }

      // Калькулятор: упрощённая модель рассрочки + аренда
      function CalcView({ catalog, villaId }) {
        const villa = useMemo(() => {
          for (const p of catalog) {
            const v = p.villas.find((x) => x.villaId === villaId);
            if (v) return { ...v, projectName: p.projectName };
          }
          return null;
        }, [catalog, villaId]);

        // Параметры рассрочки
        const [qty, setQty] = useState(1);
        const [discountPct, setDiscountPct] = useState(0);
        const [prePct, setPrePct] = useState(70);
        const [handoverMonth, setHandoverMonth] = useState(12);
        const [months, setMonths] = useState(12);
        const [ratePct, setRatePct] = useState(8.33); // % в месяц (примерно 100%/12)
        const [occupancyPct, setOccupancyPct] = useState(70);

        if (!villa) {
          return (
            <div className="mx-auto max-w-7xl px-5 py-6">
              <a className="px-3 py-1.5 rounded-lg border" href="#/catalog">← Назад</a>
              <div className="mt-4 text-red-600">Вилла не найдена</div>
            </div>
          );
        }

        const baseOne = Math.max(0, villa.baseUSD || villa.area * villa.ppsm);
        const afterDiscountOne = baseOne * (1 - (discountPct || 0) / 100);
        const baseQ = afterDiscountOne * qty;

        // До ключей
        const preTotal = baseQ * (prePct / 100);
        const firstPostUSD = 0;

        // Пост‑handover: равномерное погашение principal + проценты на остаток
        const principalBase = Math.max(0, baseQ - preTotal - firstPostUSD);
        const vMonths = Math.max(0, months);
        const rate = (ratePct || 0) / 100;

        let bal = principalBase, totalInterest = 0;
        const principalShare = vMonths > 0 ? principalBase / vMonths : 0;
        const postRows = [];
        for (let i = 1; i <= vMonths; i++) {
          const interest = bal * rate;
          totalInterest += interest;
          const payment = principalShare + interest;
          postRows.push({
            i,
            principalUSD: principalShare,
            interestUSD: interest,
            paymentUSD: payment,
            balanceAfterUSD: Math.max(0, bal - principalShare),
          });
          bal -= principalShare;
        }

        const finalUSD = baseQ + totalInterest;
        const afterUSD = finalUSD - preTotal;

        // Аренда: net ~ 55%, индексация на первый год игнорируем (упростим), можно варьировать
        const avgDaysPerMonth = 30.44;
        const firstYearRental = (villa.dailyRateUSD || 0) * 0.55 * (occupancyPct / 100) * avgDaysPerMonth * 12 * qty;

        return (
          <div className="mx-auto max-w-7xl px-5 py-6">
            <div className="flex items-center justify-between">
              <a className="px-3 py-1.5 rounded-lg border" href="#/catalog">← Каталог</a>
              <div className="text-sm text-neutral-500">{villa.projectName}</div>
            </div>

            <h2 className="text-xl font-semibold mt-4">{villa.name}</h2>
            <div className="text-sm text-neutral-600 mt-1">
              {fmtInt(villa.area)} м² · ${fmtInt(villa.ppsm)} / м² · База: {fmtMoney(baseOne)}
            </div>

            {/* Параметры */}
            <div className="grid md:grid-cols-2 gap-4 mt-4">
              <div className="border rounded-2xl p-4">
                <h3 className="font-medium mb-3">Параметры сделки</h3>
                <div className="grid grid-cols-2 gap-3">
                  <label className="grid gap-1">
                    <span className="text-sm text-neutral-600">Кол-во</span>
                    <input className="px-3 py-2 rounded-xl border" type="number" min="1" step="1" value={qty} onChange={(e) => setQty(clamp(parseInt(e.target.value || 0, 10), 1, 9999))} />
                  </label>
                  <label className="grid gap-1">
                    <span className="text-sm text-neutral-600">Скидка, %</span>
                    <input className="px-3 py-2 rounded-xl border" type="number" min="0" step="0.1" value={discountPct} onChange={(e) => setDiscountPct(clamp(parseFloat(e.target.value || 0), 0, 100))} />
                  </label>
                  <label className="grid gap-1 col-span-2">
                    <span className="text-sm text-neutral-600">До ключей, %: {prePct}%</span>
                    <input type="range" min="50" max="100" step="1" value={prePct} onChange={(e) => setPrePct(parseInt(e.target.value, 10))} />
                  </label>
                </div>
              </div>

              <div className="border rounded-2xl p-4">
                <h3 className="font-medium mb-3">Рассрочка и аренда</h3>
                <div className="grid grid-cols-2 gap-3">
                  <label className="grid gap-1">
                    <span className="text-sm text-neutral-600">До ключей, мес</span>
                    <input className="px-3 py-2 rounded-xl border" type="number" min="1" step="1" value={handoverMonth} onChange={(e) => setHandoverMonth(clamp(parseInt(e.target.value || 0, 10), 1, 120))} />
                  </label>
                  <label className="grid gap-1">
                    <span className="text-sm text-neutral-600">После ключей, мес</span>
                    <input className="px-3 py-2 rounded-xl border" type="number" min="6" step="1" value={months} onChange={(e) => setMonths(clamp(parseInt(e.target.value || 0, 10), 6, 120))} />
                  </label>
                  <label className="grid gap-1">
                    <span className="text-sm text-neutral-600">Ставка, %/мес</span>
                    <input className="px-3 py-2 rounded-xl border" type="number" min="0" step="0.01" value={ratePct} onChange={(e) => setRatePct(clamp(parseFloat(e.target.value || 0), 0, 1000))} />
                  </label>
                  <label className="grid gap-1">
                    <span className="text-sm text-neutral-600">Заполняемость, %</span>
                    <input className="px-3 py-2 rounded-xl border" type="number" min="0" max="100" step="1" value={occupancyPct} onChange={(e) => setOccupancyPct(clamp(parseFloat(e.target.value || 0), 0, 100))} />
                  </label>
                </div>
              </div>
            </div>

            {/* KPI */}
            <div className="grid md:grid-cols-4 gap-3 mt-4">
              <Kpi label="Сумма (после скидки)" value={fmtMoney(baseQ)} />
              <Kpi label="До ключей" value={fmtMoney(preTotal)} />
              <Kpi label="После ключей" value={fmtMoney(afterUSD)} />
              <Kpi label="Итоговая стоимость" value={fmtMoney(finalUSD)} />
            </div>
            <div className="grid md:grid-cols-3 gap-3 mt-3">
              <Kpi label="Проценты" value={fmtMoney(totalInterest)} />
              <Kpi label="Аренда (1-й год, net)" value={fmtMoney(firstYearRental)} />
              <Kpi label="Окупаемость (аренда / итог)" value={`${((firstYearRental / finalUSD) * 100).toFixed(1)}%`} />
            </div>

            {/* График платежей после ключей */}
            <div className="border rounded-2xl p-4 mt-4">
              <h3 className="font-medium mb-3">График платежей после ключей</h3>
              <div className="overflow-x-auto">
                <table className="w-full text-sm min-w-[800px]">
                  <thead>
                    <tr className="bg-neutral-50">
                      <Th>#</Th>
                      <Th>Тело</Th>
                      <Th>Проценты</Th>
                      <Th>Платёж</Th>
                      <Th>Остаток</Th>
                    </tr>
                  </thead>
                  <tbody>
                    {postRows.map((r) => (
                      <tr key={r.i} className="border-t">
                        <Td>{r.i}</Td>
                        <Td>{fmtMoney(r.principalUSD)}</Td>
                        <Td>{fmtMoney(r.interestUSD)}</Td>
                        <Td>{fmtMoney(r.paymentUSD)}</Td>
                        <Td>{fmtMoney(r.balanceAfterUSD)}</Td>
                      </tr>
                    ))}
                    {postRows.length === 0 && <tr><td className="px-3 py-3 text-neutral-500" colSpan={5}>Нет рассрочки</td></tr>}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        );
      }

      function Kpi({ label, value }) {
        return (
          <div className="rounded-2xl border p-4 bg-white">
            <div className="text-xs text-neutral-500">{label}</div>
            <div className="text-lg font-semibold mt-1">{value}</div>
          </div>
        );
      }

      function Th({ children }) {
        return <th className="px-2 py-2 md:px-3 md:py-3 text-left font-medium align-top whitespace-normal break-normal leading-snug">{children}</th>;
      }
      function Td({ children, className = "" }) {
        return <td className={`px-2 py-2 md:px-3 md:py-3 align-top whitespace-nowrap leading-snug ${className}`}>{children}</td>;
      }

      // Корневой App
      function App() {
        const route = useHashRoute();
        const [catalog, setCatalog] = useState(loadCatalog());
        const [isAdmin, setIsAdmin] = useState(false);

        useEffect(() => saveCatalog(catalog), [catalog]);

        return (
          <div className="min-h-screen bg-white">
            <Header />
            {route.path === "#/admin" ? (
              isAdmin ? (
                <AdminPanel catalog={catalog} setCatalog={setCatalog} />
              ) : (
                <AdminGate onLogin={() => setIsAdmin(true)} />
              )
            ) : route.path === "#/calc" ? (
              <CalcView catalog={catalog} villaId={route.params.villaId} />
            ) : (
              <CatalogView catalog={catalog} />
            )}
            <footer className="mx-auto max-w-7xl px-5 py-10 text-center text-sm text-neutral-500">
              © {new Date().getFullYear()} Arconique · Данные каталога сохраняются локально в вашем браузере.
            </footer>
          </div>
        );
      }

      const root = createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
