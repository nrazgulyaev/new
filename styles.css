/* styles.css */
/* продолжаем */

/* ========== Base / Reset ========== */
*,
*::before,
*::after { box-sizing: border-box; }

html, body { height: 100%; }

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  color: #111;
  background: #f7f7f9;
  line-height: 1.4;
}

img { max-width: 100%; display: block; }

/* Links reset for buttons-as-links in app */
a { color: inherit; text-decoration: none; }

/* ========== Layout ========== */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 14px 16px;
}

.header { }
.h1 { font-weight: 700; }

/* ========== Reveal animation ========== */
.reveal { opacity: 0; transform: translateY(8px); transition: opacity .35s ease, transform .35s ease; }
.reveal.is-visible { opacity: 1; transform: translateY(0); }

/* ========== Buttons ========== */
.btn {
  appearance: none;
  border: 1px solid #d0d7de;
  background: #fff;
  color: #111;
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  line-height: 1;
  transition: background .2s, border-color .2s, color .2s, box-shadow .2s;
}
.btn:hover { background: #f6f8fa; }
.btn:active { background: #eef1f4; }
.btn.primary { background: #1f6feb; border-color: #1f6feb; color: #fff; }
.btn.primary:hover { background: #1a64d6; border-color: #1a64d6; }
.btn.danger { background: #fef2f2; border-color: #ef4444; color: #b91c1c; }
.btn.danger:hover { background: #fee2e2; }
.btn.success { background: #ecfdf5; border-color: #10b981; color: #047857; }
.btn.success:hover { background: #d1fae5; }
.btn.small { padding: 6px 10px; font-size: 13px; }
.btn.icon { padding: 6px 8px; }
.btn.tiny { padding: 4px 6px; font-size: 12px; }

.badge {
  display: inline-flex;
  align-items: center;
  height: 24px;
  padding: 0 8px;
  border-radius: 999px;
  background: #eef2ff;
  color: #3730a3;
  font-size: 12px;
  font-weight: 600;
}

.pill {
  display: inline-flex;
  align-items: center;
  height: 26px;
  padding: 0 10px;
  border-radius: 999px;
  background: #f3f4f6;
  color: #111827;
  font-size: 12px;
  gap: 6px;
}
.pill-muted { background: #eef2ff; color: #3730a3; }
.pill.link {
  cursor: pointer;
  border: 1px solid #e5e7eb;
  background: #fff;
}
.pill.link:hover { background: #f9fafb; }

/* ========== Catalog ========== */
.catalog-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
  margin-bottom: 10px;
}
.catalog-controls {
  display: inline-flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 6px;
}
.search-input {
  height: 32px;
  padding: 0 10px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  font-size: 14px;
  min-width: 220px;
}

.project-anchors {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  margin: 8px 0 12px;
}

.catalog-list { display: flex; flex-direction: column; gap: 12px; }

.project-card {
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 12px;
  box-shadow: 0 1px 2px rgba(16,24,40,.04);
}
.project-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
}
.project-actions { }

.pill-row { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 10px; }

.project-details-grid {
  display: grid;
  grid-template-columns: 1.2fr .8fr;
  gap: 12px;
  margin-bottom: 10px;
}
@media (max-width: 900px) {
  .project-details-grid { grid-template-columns: 1fr; }
}

.project-includes .includes-title {
  font-size: 12px;
  color: #6b7280;
  margin-bottom: 6px;
}
.includes-list {
  margin: 0;
  padding-left: 18px;
}
.masterplan-card {
  display: block;
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  overflow: hidden;
  background: #fafafa;
}
.masterplan-img {
  width: 100%;
  height: 220px;
  object-fit: cover;
  background: #f3f4f6;
}
.label { font-size: 12px; color: #6b7280; }

/* Table common */
.table-wrap,
.calc-scroll,
.cashflow-scroll,
.factors-table-scroll {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}
.scroll-x { overflow-x: auto; }

.catalog-table,
.calc-table,
.factors-table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
}
.catalog-table th, .catalog-table td,
.calc-table th, .calc-table td,
.factors-table th, .factors-table td {
  border-bottom: 1px solid #eef2f7;
  padding: 8px 10px;
  text-align: center;
  vertical-align: middle;
  background: #fff;
  white-space: nowrap;
}
.catalog-table thead th,
.calc-table thead th,
.factors-table thead th {
  position: sticky;
  top: 0;
  background: #f9fafb;
  z-index: 1;
  font-weight: 600;
  color: #374151;
}
.td-left { text-align: left; }
.w-1 { width: 1%; }

.base-strong { font-weight: 700; color: #0f172a; }
.line-total { font-weight: 700; color: #0f172a; }

/* Status */
.status {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  height: 24px;
  padding: 0 8px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 600;
  border: 1px solid;
}
.status-available { background: #ecfdf5; color: #065f46; border-color: #a7f3d0; }
.status-reserved { background: #fef3c7; color: #92400e; border-color: #fde68a; }
.status-hold { background: #f3f4f6; color: #374151; border-color: #e5e7eb; }

/* Divider */
.divider-line {
  height: 1px;
  background: #e5e7eb;
  margin: 12px 0;
}

/* Grid tiles used in reports/KPI */
.catalog-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0,1fr));
  gap: 8px;
}
@media (max-width: 700px) {
  .catalog-grid { grid-template-columns: 1fr; }
}
.villa-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  padding: 10px;
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  background: #fff;
  cursor: pointer;
}
.villa-info .value { font-weight: 600; }
.villa-info .label { font-size: 12px; color: #6b7280; }

/* ========== Modal / Portal ========== */
.portal-root { position: relative; z-index: 9999; }
.modal-overlay {
  position: fixed; inset: 0;
  background: rgba(17, 24, 39, .48);
  display: flex; align-items: center; justify-content: center;
  padding: 16px;
}
.modal-content {
  width: 100%;
  max-width: 960px;
  background: #fff;
  border-radius: 12px;
  border: 1px solid #e5e7eb;
  box-shadow: 0 10px 30px rgba(0,0,0,.12);
  padding: 14px;
}
.modal-actions {
  display: flex; gap: 8px; justify-content: flex-end; margin-top: 10px;
}

/* Forms */
.row, .form-row {
  display: grid;
  grid-template-columns: repeat(2, minmax(0,1fr));
  gap: 10px;
}
@media (max-width: 800px) {
  .row, .form-row { grid-template-columns: 1fr; }
}
.form-group { display: flex; flex-direction: column; gap: 6px; }
.form-group > label { font-size: 12px; color: #6b7280; }
.input, select.input {
  height: 36px;
  padding: 0 10px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  background: #fff;
  font-size: 14px;
}

/* ========== Cards (Calculator) ========== */
.card {
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 12px;
  margin-bottom: 12px;
}
.card-header {
  display: flex; align-items: center; justify-content: space-between;
  gap: 10px; margin-bottom: 8px;
}
.top-section {
  display: grid;
  grid-template-columns: 1.1fr .9fr;
  gap: 12px;
  margin-bottom: 12px;
}
@media (max-width: 1000px) {
  .top-section { grid-template-columns: 1fr; }
}

/* Settings */
.field.compact {
  display: grid; gap: 6px;
}
.field.compact > label { font-size: 12px; color: #6b7280; }
.info-display {
  min-height: 36px;
  display: inline-flex; align-items: center; padding: 0 10px;
  border-radius: 8px; border: 1px dashed #d1d5db; color: #111;
}

/* Stages table (preinstallments) */
.stages-card .stages-scroll { overflow-x: auto; }
.factors-table { table-layout: fixed; width: 100%; }
.stages-col-name { width: 58%; }
.stages-col-pct { width: 16%; }
.stages-col-month { width: 16%; }

.compact-input {
  width: 100%;
  height: 32px;
  padding: 0 8px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  font-size: 14px;
  background: #fff;
}

/* Narrow cells: optionally clamp width by context if no inline maxWidth */
.factors-table td:nth-child(2) .compact-input,
.factors-table td:nth-child(3) .compact-input { max-width: 110px; }

.range { width: 100%; }

/* KPI */
.kpi-header-pills { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 8px; }
.kpis { display: grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap: 8px; }
@media (max-width: 1100px) { .kpis { grid-template-columns: repeat(2, minmax(0,1fr)); } }
@media (max-width: 640px) { .kpis { grid-template-columns: 1fr; } }
.kpi, .pair-item {
  border: 1px solid #e5e7eb; border-radius: 10px; padding: 10px; background: #fff;
}
.kpi .muted, .pair-item .muted { color: #6b7280; font-size: 12px; margin-bottom: 4px; }
.kpi .v, .pair-item .v { font-size: 16px; font-weight: 700; color: #0f172a; }
.kpi-pair { display: grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 8px; }

/* Cashflow */
.cashflow-block .card-header h2 { margin: 0; font-size: 18px; }
.export-buttons { display: inline-flex; gap: 8px; flex-wrap: wrap; }
.cashflow-scroll { overflow-x: auto; }

/* Signs */
.positive { color: #16a34a; font-weight: 600; }
.negative { color: #dc2626; font-weight: 600; }

/* Chart */
.pricing-chart-container { }
.chart-subtitle { color: #6b7280; font-size: 12px; margin: 4px 0 8px; }
.pricing-chart-svg {
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  background: #fff;
  overflow: hidden;
}

/* Factors tables wrappers */
.factors-table-container { margin-top: 12px; }
.factors-table-scroll { overflow-x: auto; }
.factors-table th, .factors-table td { font-size: 13px; }
.price-cell, .rental-cell, .total-capital-cell, .payment-cell,
.yearly-roi-cell, .cumulative-roi-cell, .irr-cell { white-space: nowrap; }

/* Anchors / Pills */
.project-anchors .pill.link { border-color: #e5e7eb; }

/* ========== Print mode for html2pdf clones ========== */
.print-mode {
  background: #fff !important;
  color: #111 !important;
}
.print-mode .card { box-shadow: none !important; }
.print-mode .catalog-table thead th,
.print-mode .calc-table thead th,
.print-mode .factors-table thead th { position: relative !important; top: auto !important; }

/* ========== Utility ========== */
.scroll-x { overflow-x: auto; }
